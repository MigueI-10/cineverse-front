import{a as x}from"./chunk-VK4RGVHF.js";import{a as m,b as k}from"./chunk-ROIV5QGY.js";import{D as u,_ as b,ea as f,j as d,jb as g,n as l,o as h,r as a}from"./chunk-VZFTKLKS.js";var c=function(n){return n.checking="checking",n.authenticated="authenticated",n.notAuthenticated="notAuthenticated",n}(c||{});var F=(()=>{let i=class i{constructor(){this.baseUrl=x.baseUrl,this.http=f(k),this._usrActual=g(null),this._authStatus=g(c.checking),this.usrActual=this._usrActual,this.authStatus=this._authStatus,this.isLoggedInSubject=new d(!1),this.isLoggedIn$=this.isLoggedInSubject.asObservable(),this.checkAuthStatus().subscribe()}login(r,t){let o=`${this.baseUrl}/auth/login`,e={email:r,password:t};return this.http.post(o,e).pipe(a(s=>(console.log(s.user),this._usrActual.set(s.user),this._authStatus.set(c.authenticated),localStorage.setItem("token",s.token),this.isLoggedInSubject.next(!0),console.log("token grabado"),!0)),u(s=>h(()=>s.error.message)))}register(r,t,o,e){let s=`${this.baseUrl}/auth/register`,S={email:t,name:o,password:e,tokenCaptcha:r};return this.http.post(s,S).pipe(a(p=>(console.log(p),!0)),u(p=>h(()=>p.error.message)))}sendEmailChangePassword(r){let t=`${this.baseUrl}/auth/renew-password`,o={email:r};return this.http.patch(t,o).pipe(a(e=>!0),u(e=>h(()=>e.error.message)))}confirmChangePassword(r,t){let o=`${this.baseUrl}/auth/verify-password`,e={token:r,password:t};return this.http.patch(o,e).pipe(a(s=>(console.log(s),s)),u(s=>h(()=>s.error.message)))}activateAccount(r){let t=`${this.baseUrl}/auth/activate-account`,o={token:r};return this.http.post(t,o).pipe(a(e=>(console.log(e),e)),u(e=>h(()=>e.error.message)))}checkAuthStatus(){let r=`${this.baseUrl}/auth/check-token`,t=localStorage.getItem("token");if(console.log({token:t}),!t)return this.logout(),l(!1);let o=new m().set("Authorization",`Bearer ${t}`);return this.http.get(r,{headers:o}).pipe(a(e=>(this._usrActual.set(e.user),this._authStatus.set(c.authenticated),localStorage.setItem("token",e.token),!0)),u(()=>(this._authStatus.set(c.notAuthenticated),l(!1))))}banUser(r){let t=localStorage.getItem("token");console.log(t),console.log(r);let o=new m().set("Authorization",`Bearer ${t}`);return this.http.patch(`${this.baseUrl}/auth/ban-user/${r}`,null,{headers:o}).pipe(a(()=>!0),u(e=>(console.log(e),l(!1))))}logout(){localStorage.removeItem("token"),this._usrActual.set(null),this._authStatus.set(c.notAuthenticated)}};i.\u0275fac=function(t){return new(t||i)},i.\u0275prov=b({token:i,factory:i.\u0275fac,providedIn:"root"});let n=i;return n})();export{c as a,F as b};
