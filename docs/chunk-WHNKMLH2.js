import{b as K}from"./chunk-JJSDBTMF.js";import{u as se,z as me}from"./chunk-MG4W3XTZ.js";import{A as ie,B as oe,C as ne,D as re,F as ae,a as h,b as C,c as X,d as Y,h as Z,l as ee,y as te}from"./chunk-LNHBMWTA.js";import"./chunk-7B4WEPGY.js";import{a as Q}from"./chunk-2NBET2DA.js";import{a as G}from"./chunk-VK4RGVHF.js";import{b as R,i as z}from"./chunk-ROIV5QGY.js";import{$b as V,Ab as F,Bb as N,Cb as a,D as I,Db as s,Eb as M,Ib as P,Kb as _,Lb as p,Pb as U,Rc as H,Vb as u,Wb as b,Xb as O,Ya as c,Yb as D,Za as d,Zb as L,_ as T,_b as A,ac as $,bc as q,da as j,hc as W,ja as w,jc as J,n as y,pb as f,r as x,rb as S,sa as g,ta as v,ub as E,xb as k,yb as B}from"./chunk-VZFTKLKS.js";var ce=(()=>{let o=class o{constructor(e){this.http=e,this.urlBackEnd=G.baseUrl}delComment(e){return this.http.delete(`${this.urlBackEnd}/comments/${e}`).pipe(x(()=>!0),I(t=>(console.log(t),y(!1))))}};o.\u0275fac=function(t){return new(t||o)(j(R))},o.\u0275prov=T({token:o,factory:o.\u0275fac,providedIn:"root"});let i=o;return i})();var ue=()=>({"margin-left":".5em"});function fe(i,o){if(i&1&&(a(0,"div",4)(1,"div"),u(2),s()()),i&2){let r=o.$implicit;c(2),b(r.titulo)}}function _e(i,o){if(i&1&&(a(0,"div",4)(1,"div"),u(2),s()()),i&2){let r=o.$implicit;c(2),b(r.titulo)}}function he(i,o){if(i&1){let r=P();a(0,"p-button",8),_("onClick",function(t){g(r);let n=p().$implicit,m=p(2);return v(m.borrarComentario(n._id,t))}),s(),a(1,"p-button",9),_("onClick",function(t){g(r);let n=p().$implicit,m=p(2);return v(m.banearUsuario(n.idUsuario._id,n._id,t))}),s()}i&2&&(c(),E(q(2,ue)))}function Ce(i,o){if(i&1&&(a(0,"p-card",5),W(1,"date"),a(2,"p",6),u(3),s(),f(4,he,2,3,"ng-template",7),s()),i&2){let r=o.$implicit;U("header","",r.idUsuario.name," - ",J(1,4,r.fecha,"dd/MM/yyyy"),""),c(3),O(" ",r.contenido," ")}}function ge(i,o){if(i&1&&(a(0,"div",3),F(1,Ce,5,7,"p-card",5,B),s()),i&2){let r=p();c(),N(r.aComments)}}var Ae=(()=>{let o=class o{constructor(e,t,n,m,l,le){this._authService=e,this._mediaService=t,this._commentService=n,this._routerService=m,this.confirmationService=l,this.messageService=le,this.aMedia=[],this.aComments=[]}ngOnInit(){this.cargarMedia()}cargarMedia(){let e=localStorage.getItem("media");e?this.aMedia=JSON.parse(e):this._mediaService.getAllMedia().subscribe(t=>{this.aMedia=t,localStorage.setItem("media",JSON.stringify(t))})}onMediaChange(){if(this.aComments=[],this.selectedMedia!==void 0){let e=this.selectedMedia._id;e!==void 0&&this._mediaService.getCommentsOfAFilm(e).subscribe(t=>{if(console.log(t),t.length<=0)return this.errorToast("Esta Pelicula / Serie no tiene comentarios");this.aComments=t})}}borrarComentario(e,t){e!==""&&this.confirmationService.confirm({target:t.target,message:"Seguro que quieres borrar el comentario?",header:"Accion Importante",icon:"pi pi-exclamation-triangle",acceptIcon:"none",rejectIcon:"none",rejectButtonStyleClass:"p-button-text",acceptLabel:"Si",rejectLabel:"No",accept:()=>{this._commentService.delComment(e).subscribe(n=>{n?this.success("Comentario eliminado correctamente"):this.errorToast("Error al eliminar el comentario"),this.onMediaChange()})},reject:()=>{this.messageService.add({severity:"info",summary:"Informacion",detail:"No se ha borrado el comentario",life:3e3})}})}banearUsuario(e,t,n){e!==""&&this.confirmationService.confirm({target:n.target,message:"Seguro que quieres banear al Usuario?",header:"Accion Importante",icon:"pi pi-exclamation-triangle",acceptIcon:"none",rejectIcon:"none",rejectButtonStyleClass:"p-button-text",acceptLabel:"Si",rejectLabel:"No",accept:()=>{this._authService.banUser(e).subscribe(m=>{m?(this.success("Usuario baneado correctamente"),this._commentService.delComment(t).subscribe(l=>{l?this.success("Comentario eliminado correctamente"):this.errorToast("Error al eliminar el comentario")})):this.errorToast("Error al banear el comentario"),this.aComments=[],this.onMediaChange()})},reject:()=>{this.messageService.add({severity:"info",summary:"Informacion",detail:"No se ha borrado el actor",life:3e3})}})}success(e){this.messageService.add({severity:"success",summary:"Success",detail:e})}errorToast(e){this.messageService.add({severity:"error",summary:"Error",detail:e})}};o.\u0275fac=function(t){return new(t||o)(d(K),d(Q),d(ce),d(z),d(h),d(C))},o.\u0275cmp=w({type:o,selectors:[["app-comentarios"]],standalone:!0,features:[V([C,h]),$],decls:9,vars:5,consts:[["optionLabel","titulo","filterBy","titulo","placeholder","Selecciona uno de la lista",3,"ngModelChange","onChange","options","ngModel","filter","showClear"],["pTemplate","selectedItem"],["pTemplate","item"],[1,"comentarios"],[1,"flex","align-items-center","gap-2"],[3,"header"],[1,"m-0"],["pTemplate","footer"],["label","Borrar","icon","pi pi-trash","severity","danger",3,"onClick"],["label","Banear Usuario","icon","pi pi-ban","severity","help",3,"onClick"]],template:function(t,n){t&1&&(a(0,"h1"),u(1,"Peliculas / Series"),s(),M(2,"p-toast")(3,"p-confirmDialog"),a(4,"p-dropdown",0),A("ngModelChange",function(l){return L(n.selectedMedia,l)||(n.selectedMedia=l),l}),_("onChange",function(){return n.onMediaChange()}),f(5,fe,3,1,"ng-template",1)(6,_e,3,1,"ng-template",2),s(),M(7,"hr"),f(8,ge,3,0,"div",3)),t&2&&(c(4),S("options",n.aMedia),D("ngModel",n.selectedMedia),S("filter",!0)("showClear",!0),c(4),k(8,n.aComments.length>0?8:-1))},dependencies:[me,H,ae,X,Y,ie,oe,ne,re,se,te,Z,ee],styles:["[_ngcontent-%COMP%]:ng-deep   p-dropdown[_ngcontent-%COMP%]{background:#000}.comentarios[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.5em}"]});let i=o;return i})();export{Ae as ComentariosComponent};
